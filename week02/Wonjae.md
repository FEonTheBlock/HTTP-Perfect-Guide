# 3장 HTTP 메세지

## 메세지의 흐름

### 메세지는 원 서버 방향을 인바운드로 하여 송신된다.

- **인바운드**: 클라이언트에서 서버로
- **아웃바운드**: 서버에서 클라이언트로

### 다운스트림으로 흐르는 메세지

- 메세지의 발송자는 수신자의 업스트림이다.
- 클라이언트 -> 서버 -> 클라이언트의 과정이 강물(`다운스트림`)처럼 흐른다.

## 메세지의 각 부분

> 시작줄, 헤더블록, 본문

### 메세지 문법

> 모든 HTTP 메세지는 요청 메세지 or 응답 메세지로 분류된다.

```shell
// 요청 메시지 형식
<메서드> <요청 URL> <버전>
<헤더>

<엔터티 본문>

// 응답 메시지 형식
<버전> <상태 코드> <사유 구절>
<헤더>

<엔터티 본문>
```

## HTTP의 구성요소에 대한 설명

### 메서드

> `GET`, `POST`, `PUT`, `PATCH`, `DELETE`
>
> - `HEAD`: 서버에서 어떤 문서에 대한 헤더를 가져옴
> - `TRACE`: 메세지가 프락시를 거쳐 서버에 도달하는 과정을 추적
> - `OPTIONS`: 주로 `preflight`에 사용되는 메서드(특정 메서드를 수행할 수 있는지 확인)
>
> 이외의 서버에서 사용하는 메서드는 확장 메서드

### 상태 코드

> 클라이언트에게 무엇이 발생했는지 설명함

| 전체 범위 | 정의된 범위 | 분류 |
| 100번대 | 100-101 | 정보 |
| 200번대 | 200-206 | 성공 |
| 300번대 | 300-305 | 리다이렉션 |
| 400번대 | 400-415 | 클라이언트 에러 |
| 500번대 | 500-505 | 서버 에러 |

### 버전 번호

```shell
HTTP/x.x
```

- 요청과 응답 메세지 모두에 기술된다.
- ex) `HTTP/1.1`버전 번호를 응답 받으면 응답의 프로토콜 버전이 해당 버전이 아니고, 응답을 보낸 애플리케이션이 그 버전까지 이해할 수 있음을 의미

### 헤더

> - 빈줄(CRLF)로 끝나 헤더 목록의 끝과 엔터티 본문의 시작을 표시
> - 마지막 CRLF를 실수로 빠뜨리는 구현체와의 호환을 위해 클라이언트와 서버는 마지막 CRLF 없이 끝나는 메세지도 받아 들일 수 있어야 한다.

**일반 헤더**

> 클라이언트, 서버 모두 사용

- Date 헤더: 서버가 만들어진 일시 지칭
- 일반 캐시헤더: 로컬 복사본으로 캐시할 수 있도록 해주는 최초의 헤더(`ex:Cache-Control`)
- 메세지에 대한 기본적인 정보를 제공

**요청 헤더**

- Accept 헤더: 서버에게 클라이언트가 자신의 요청에 대응하는 미디어 타입을 받아들임
- Accept 관련 헤더: 자신의 선호와 능력을 알려주어 서버와 클라이언트 모두에게 유익한 헤더
- 조건부 요청 헤더: 요청에 제약을 넣음
- 요청 보안 헤더: HTTP 자체적으로 요청을 하기 위한 간단한 인증요구/응답 체계를 갖고 있음
  - ex) `Authorization`, `Cookie`
- 프락시 요청 헤더: 프락시 기능을 돕기위한 헤더

**응답 헤더**

> 클라이언트에게 정보를 제공하기 위한 자신만의 헤더

- 협상 헤더: 여러가지 표현이 가능한 경우 `HTTP/1.1`은 서버와 클라이언트가 어떤 표현을 선택할 것인가에 대한 협상 지원
- 응답 보안 헤더: 기본적인 인증요구 헤더
  - ex)`Proxy-Authenticate`, `Set-Cookie`(서버가 클라이언트를 인증할 수 있도록 클라이언트 측에 토큰 설정하기 위해 사용)

**엔터티 헤더**

> 엔터티 본문에 대한 헤더

- 콘텐츠 헤더: 엔터티의 콘텐츠에 대한 구체적인 정보 제공
  - ex) `Content-`로 시작하는 헤더들
- 엔터티 캐싱 헤더: 엔터티 캐싱에 대한 정보로 리소스에 대한 캐시 사본이 아직 유효한지 정보와 캐시된 리소스가 더 이상 유효하지 않게 되는 시점을 더 잘 추정하기 위한 단서
  - ex) `Expires`, `Last-Modified`...

**확장 헤더**

> 아직 승인된 HTTP명세에는 추가되지 않은 비표준 헤더
