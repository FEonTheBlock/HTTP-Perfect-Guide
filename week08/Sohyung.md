## 들어가며

HTTP 완벽 가이드 7장 캐시를 정리한다.



## 7장 캐시

> 웹 개시란 자주 쓰이는 문서의 사본을 자동으로 보관하는 HTTP 장치다.
>
> - 불필요한 데이터 전송을 줄인다.
> - 네트워크 병목을 줄인다.
> - 원 서버에 대한 요청을 줄인다 -> 부하를 줄이고 -> 빠른 응답
> - 요청 거리로 인한 지연을 줄여준다.


### 7.1 불필요한 데이터 전송

복수의 클라이언트가 자주 쓰이는 **원 서버**(?) 페이지에 접근할 때, 같은 문서를 클라이언트들에게 한 번씩 전송한다. 캐시를 사용하여 한 번만 응답받은 후 사본을 사용하면 불필요한 데이터 전송을 막을 수 있다.


### 7.2 대역폭 병목

많은 네트워크가 원격 서버보가 로컬 네트워크 클라이언트에 더 넓은 대역폭을 제공한다. 즉, 느린 WAN 접속보다 빠른 LAN에 있는 캐시로부터 사본을 가져온다면 성능을 대폭 향상시킬 수 있다.

**개념 정리**

- 네트워크 대역폭 : 단위 시간 내 전달할 수 있는 최대 크기의 전달 용량

  - bits per second (`bps`)
  - megabits per second (`Mbps`)
  - gigabits per second (`Gbps`)

- 네트워크 출력 : 단위 시간 내 전송할 수 있는 최대 크기의 전달 용량
- 병목(bottle neck) 현상 : 전체 시스템의 성능이나 용량이 하나의 구성 요소로 인해 제한을 받는 현상을 말한다. [위키 백과](https://ko.wikipedia.org/wiki/%EB%B3%91%EB%AA%A9)
- LAN(Local Area Network) : 근거리 통신 망. 집, 사무실, 빌딩, 공장 등과 같이 제한된 지역에서 여러대의 장치들을 연결 하기 위하여 최적화 되고 신뢰성 있는 고속 통신을 제공 하는 네트워크 (버스형, 링형, 스타형, 계층형, 메쉬형 등)
- WAN (Wide Ares Network) : 광대역 네트워크


### 7.3갑작스런 요청 쇄도(Flash Crowds)

핫 이슈에 따라 갑작스럽게 트래픽 급증하면 응답을 전송해야할 요청들이 너무 많아지게 된다. (1998년 9/11 미 하원 웹 서버는 한 시간 동안 3백만 건이 넘는 요청을 받았음. 평소보다 50배)

그림7-2를 통해 갑작스런 요청 쇄도와 웹 서버의 과부하에 대해 보여주고 있다. 다만 이것은 대역폭에 관한 이해를 위한 이미지로, '실제로는 작은 객체에 대한 지연은 대역폭과 상관없는 `오버헤드`에 의해 좌우될 것이다'라고 한다.


### 7.4 거리로 인한 지연

빛의 속도로 데이터가 전송된다. 즉, 거리가 멀수록 속도가 지연된다. 기계실 근처에 캐시를 설치해서 문서가 전송되는 거리를 수천 킬로미터에서 수십 미터로 줄일 수 있다.


### 7.5 적중(cache hit)과 부적중(cache miss)

**캐시에 요청이 도착했을 때**

- 캐시 적중: 대응하는 사본이 있어 이를 처리할 수 있는 경우
- 캐시 부적중: 대응하는 사본이 없어 그냥 원 서버로 요청을 전달하는 경우
-

#### 7.5.1 재검사(Revalidation)

- 재검사: 원 서버 콘텐츠에 비하여 캐시의 사본이 여전히 최신인지 점검하는 것. '신성도 검사'

HTTP는 서버로부터 전체 객체를 가져오지 않고도 콘텐츠가 여전히 신선한지 빠르게 검사할 수 있는 특별한 요청 규칙을 정의했다.

대부분의 캐시는 `클라이언트가 사본을 요청하였으며 그 사본이 검사를 할 필요가 있을 정도로 충분히 오래된 경우`에만 재검사를 한다.

캐시는 사본의 재검사가 필요할 때 원 서버에 작은 재검사 요청을 보낸다.

- 재검사 적중(느린 적중): 콘텐츠가 변경되지 않았다면 서버는 304 Not Modified 응답을 보낸다. 캐시 적중보다는 느리지만 캐시 부적중 보다는 빠르다(객체 데이터 받을 필요 없기 때문)
- 재검사 부적중: 콘텐츠가 변경되었다면 서버는 해당 서버 객체 데이터를 전송한다.

**HTTP가 캐시된 객체를 재확인하기 위한 도구**

- `If-Modified-Since`: GET 요청의 헤더에 추가시 캐시된 시간 이후에 변경된 경우에만 사본을 보내달라는 의미
  - 서버 콘텐츠가 변경되지 않은 경우: 재검사 적중. 서버 -> HTTP 304 응답
  - 서버 콘텐츠가 변경된 경우: 서버 -> 콘텐츠 전체 + HTTP 200 OK 응답
  - 객체가 삭제된 경우: 서버 -> 404 NOT FOUND 응답, 캐시 -> 사본 삭제

#### 7.5.2 적중률

- 적중률(캐시 적중률, 문서 적중률): 캐시가 요청을 처리하는 비율
- 100%에 근접하는 것이 이상적이되 40% 정도만 되어도 괜찮은 웹 캐시다.
- 얼마나 많은 웹 트랜잭션을 외부로 재보내지 않았는가 => 전체 대기시간(지연) 줄이기

#### 7.5.3 바이트 적중률

문서의 크기가 다 다르기 때문에 객체의 수에 따른 적중률이 아닌 바이트 단위 적중률을 측정하기도 한다.
캐시를 통해 제공된 모든 바이트의 비율을 표현하므로 트래픽이 절감된 정도를 포착해낸다.

- 얼마나 많은 바이트가 인터넷으로 나가지 않았는가 => 대역폭 절약 최적화

### 7.5.4 적중과 부적중의 구별

응답 코드는 모두 200 OK 이므로 캐시 적중과 원 서버 접근을 구분할 수 있는 방법을 제공하지 않는다.

**구분 방법**

- Via 헤더에 추가 정보를 붙이는 특정 상용 프락시 캐시
- Date 헤더를 현재 시각과 비교
- Age 헤더를 이용해 응답이 얼마나 오래되었는지 알아보기

### 7.6 캐시 토폴로지

- 개인 전용 캐시(private cache): 한 명에게만 할당
- 공용 캐시(public cache): 사용자 집단에게 자주 쓰이는 페이지

**개념 정리**

- 토폴로지(topology): 컴퓨터 네트워크의 요소들(링크, 노드 등)을 물리적으로 연결해 놓은 것, 또는 그 연결 방식을 말한다. [위키백과 토폴로지](https://ko.wikipedia.org/wiki/%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC_%ED%86%A0%ED%8F%B4%EB%A1%9C%EC%A7%80#:~:text=%ED%86%A0%ED%8F%B4%EB%A1%9C%EC%A7%80(%EC%98%81%EC%96%B4%3A%20topology%2C%20%EB%AC%B8%ED%99%94%EC%96%B4,%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC%EC%9D%98%20%ED%95%9C%20%EC%98%88%EC%9D%B4%EB%8B%A4.)

#### 7.6.1 개인 전용 캐시

작고 저렴. `웹 브라우저는 개인 전용 캐시를 내장하고 있다.` 자주 쓰이는 문서를 개인용 컴퓨터의 디스크와 메모리에 캐시해 놓고, 사용자가 캐시 사이즈와 설정을 수정할 수 있도록 허용한다.

캐시된 문서들을 확인하는 방법

- IE: 도구-> 인터넷 옵션 -> 검색 기록 -> 설정 -> 파일보기
- Chrome: about:cache 를 통해 연결되는 페이지에서 캐시 콘텐츠의 목록 확인

#### 7.6.2 공용 프락시 캐시

공용 캐시는 캐시 프락시 서버 혹은 프락시 캐시라고 불리는 공유된 프락시 서버다. 여러 사용자가 접근하기 때문에 불필요한 트래픽을 줄일 수 있다.

#### 7.6.3 프락시 캐시 계층들

작은 캐시에서 캐시 부적중이 발생했을 때 더 큰 부모 캐시가 그 '걸러 남겨진' 트래픽을 처리하도록 하는 계층을 만드는 방식이 합리적인 경우가 많다.
(그림 7-9)

#### 7.6.4 캐시망, 콘텐츠 라우팅, 피어링

캐시망의 프락시 캐시는 어떤 부모 캐시와 대화할 것인지, 요청이 캐시를 완전히 우회해서 원 서버로 바로 가도록 할 것인지 등에 대한 캐시 커뮤니케이션 결정을 동적으로 내린다.

- URL에 근거하여 부모 캐시와 원 서버 중 하나를 통적으로 선택한다
- URL에 근거하여 특정 부모 캐시를 동적으로 선택한다.
- 부모 캐시 에게 가기 전에, 캐시된 사본을 로컬에서 찾아본다.
- 다른 캐시들이 그들의 캐시된 콘텐츠에 부분적으로 접근할 수 있도록 허용하되, 그들의 캐시를 통한 인터넷 트랜짓(Intemet transit)은 허용하지 않는다.

이러한 캐시 사이의 관계는 서로 다른 조직들이 상호 이득을 위해 그들의 캐시를 연결하여 서로 찾아볼 수 있도록 한다.

- 형제 캐시: 선택적인 피어링을 지원하는 캐시

HTTP는 형제 캐시를 지원하지 않기 때문에 ICP나 HTCP같은 프로토콜을 이용해 HTTP를 확장한다.(20장)

**개념 정리**

- 피어링(Peering): [인터넷 서비스 제공자](https://ko.wikipedia.org/wiki/%EC%9D%B8%ED%84%B0%EB%84%B7_%EC%84%9C%EB%B9%84%EC%8A%A4_%EC%A0%9C%EA%B3%B5%EC%9E%90 '인터넷 서비스 제공자')끼리 서로 네트워크를 연결하고 [트래픽](https://ko.wikipedia.org/wiki/%ED%8A%B8%EB%9E%98%ED%94%BD '트래픽')을 교환하는 것을 의미한다. 피어링을 위해서는 각각의 네트워크가 연결되어 있어야 하고 [BGP](https://ko.wikipedia.org/wiki/%EA%B2%BD%EA%B3%84_%EA%B2%BD%EB%A1%9C_%ED%94%84%EB%A1%9C%ED%86%A0%EC%BD%9C '경계 경로 프로토콜')를 통한 라우팅 정보의 교환과 네트워크간의 합의가 필요하다. [위키백과 피어링](https://ko.wikipedia.org/wiki/%ED%94%BC%EC%96%B4%EB%A7%81)
- 트랜짓(Transit):
- 트랜짓 vs 피어링: 피어들 간에는 자신과 고객정보만을 전달하고 다른 피어의 정보를 전달하지 않습니다. 반면에 트랜짓 관계라면 피어와 상위사업자(서비스제공 사업자의 트랜짓 사업자 - carrier's carrier)의 모든 정보를 전달합니다. [피어링(Peering)과 트랜짓(Transit)이란?](https://2infinity-and-beyond.tistory.com/12)

## 더 알아봐야할 것

- 188p 오버헤드
- 193p 웹 브라우저는 개인 전용 캐시를 내장하고 있다.
- 피어링, 트랜짓, ISP(인터넷 서비스 제공자)

## 참고 링크

-
